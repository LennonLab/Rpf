---
title: "GeneralityRpf"
author: "Venus Kuo"
date: "June 30, 2017"
output: html_document
---
# Based on growthcurve_code.R Written by: M. Larsen (2013/07/18) and M. Muscarella (2015/11/24) # 


## 1) Questions

1. How do bacteria other than KBS0714 respond to Rpf?

2. Is there a phylogenetic signal to Rpf response? 


## 2) Methods

Microbial Growth Curves on KBS enviromental strains

1.  701(-) Bacteriodetes, Sphingobacteriaceae, Pedobacter Gram -
2.  702 (+),Actinobacteria, Micrococcaceae, Arthrobacter Gram +
3.  703 (+),Actinobacteria, Micrococcaceae, Arthrobacter Gram +
4.  705 (-), Proteobacteria, Rhodospirillaceae, Azospirillium Gram - KmR. Tc and Gm inhibited growth
5.  706 (+),Actinobact., Mycobacteriaceae, Mycobacterium Gram +
6.  710 (-), Proteobacteria, Pseudomonadaceae, Pseudomonas Gram - AmR, StR, SpR, RfR
7.  711 (-), Proteobacteria, Oxalobacteriaceae, Janthinobacterium Gram -AmR, SpR
8.  712 (-), Proteobacteria, Comamonadaceae, Variovorax Gram -AmR, KmR, StR, GmR, SpR, RfR
9.  714 (+), Actinobacteria, Micrococcaceae, Micrococcus Gram +
10.  715 (+), Actinobacteria, Microbacteriaceae, Curtobacterium Gram +
11.  724 (+), Actinobacteria, Nocardiaceae, Rhodococcus Gram +
12.  812 (+). Bacillus subtilis SSB2 WT Gram +


# Set working directory #

```{r, message=FALSE, warning=FALSE}
# Set working directory #
rm(list = ls())
getwd()
setwd("C:/Users/Venus/Github/Rpf/generality/")

# Require or install packages #
package.list <- c('vegan', 'ggplot2', 'data.table' , 'nlme' , 'plyr', 'dplyr', 'reshape2', 'stats', 'agricolae') 
for (package in package.list) {
  if (!require(package, character.only=T, quietly=T)) { 
    install.packages(package)
    library(package, character.only=T)
  } }
```

## Description of the data set 

growthcurveparameters.csv : A csv file containing the growth curve parameters extracted from 20160320_rawgrowthcurve.csv and 20160323_rawgrowthcurve.csv using the Growth_Curve Repo code. The parameters described are KBS strain, phylum, genus, rep, gram, treatment, b0, A, umax, L, z, umax.lw, umax.up, umax.lw, umax.up.FI. 

gc delta.csv: A csv file containing the proportional differences between treatments for umax, A, and L growth curve parameter based on growth curve output from raw absorbance readings.

```{r}
setwd("C:/Users/Venus/Github/Rpf/generality/")

# Read growth curve parameter output #
gc <- read.csv("growthcurveparameters.csv", header = T)

# Remove NA from data set # 
gc <- na.omit(gc)

# Subset Genus from data set # 
umax.gc <- subset(gc, select = c("Genus", "Treatment", "Rep", "umax"))
A.gc <- subset(gc, select = c("Genus", "Treatment", "Rep", "A"))
L.gc <- subset(gc, select = c("Genus", "Treatment", "Rep", "L"))

# Calculate mean values of umax, A, and L # 
umax.mean <- ddply(umax.gc, c("Genus", "Treatment"), summarise, mean=mean(umax))
A.mean <- ddply(A.gc, c("Genus", "Treatment"), summarise, mean=mean(A))
L.mean <- ddply(L.gc, c("Genus", "Treatment"), summarise, mean=mean(L))


# Load proportional changes for growth curve parameter data set # 
data <- read.csv("gcdelta.csv", header=T)

# Remove NA from data set # 
data <- na.omit(data)

# Make phylogenetic distance a factor # 
data$PDKBS0714 <- factor(data$PDKBS0714)

# Subsetting each growth curve parameters from data set # 
umax <- subset(data,  select = c("Strain", "Phylum", "Genus", "Rep", "Gram", "udelta"))
A <- subset(data, select = c("Strain", "Phylum", "Genus", "Rep", "Gram", "ADelta"))
L <- subset(data, select = c("Strain", "Phylum", "Genus", "Rep", "Gram", "Ldelta"))
```

## 3) Visualizing dataset

Making boxplot figures outlining the proportional changes of growth curve parameters with Rpf treatment

```{r}
# Assigning color to each phylum box plots # 
library(RColorBrewer)
myColors <- brewer.pal(4,"Set1")
names(myColors) <- levels(data$Phylum)
colScale <- scale_colour_manual(name = "Phylum",values = myColors)


# Boxplot showing the difference in umax between treatments for each strain # 
u.boxplot <- ggplot(data, aes(x=PDKBS0714, y = udelta, fill = Phylum)) + 
  geom_boxplot(lwd = 0.75) +
  colScale
  

u.boxplot + 
  labs(x="Genera", y=expression(paste(Delta ,"Maximum growth rate"))) +
  theme_classic() +
  scale_x_discrete(labels=c("Micrococcus","Arthrobacter",
                            "Curtobacterium","Rhodococcus", "Mycobacteriaceae",
                            "Bacillus", "Azospirillium", "Janthinobacterium",
                            "Pseudomonas", "Variovorax", "Pedobacter")) +
  theme(axis.text.y=element_text(colour="black", size=18),
        axis.text.x=element_text(colour="black", size =12, angle = 35, hjust = 1),
        axis.title=element_text(size=20),
        axis.title.y = element_text(colour="black",  margin = margin(0,5,0,10)),
        axis.title.x = element_text(colour="black",margin=margin(5,0,0,0)),
        panel.border = element_rect(linetype = "solid", colour = "black", size=2, fill=NA),
        axis.ticks.length = unit(.25, "cm"),
        axis.ticks = element_line(size = 1.5),
        legend.title = element_text(size=14),
        legend.text=element_text(size=13.5)) +
  geom_hline(yintercept = 0, linetype="dashed", size = 1) + 
  annotate("text", x = 1.1 , y=0.45, label = c("A"), size=10)


# Box plot showing lag time difference between treatments # 
l.boxplot <- ggplot(data, aes(x=PDKBS0714, y = Ldelta,  fill = Phylum)) + 
  geom_boxplot(lwd = 0.75) +
  colScale

l.boxplot + 
  labs(x="Genera", y=expression(paste(Delta ,"Lag time"))) +
  theme_classic() +
  scale_x_discrete(labels=c("Micrococcus","Arthrobacter",
                            "Curtobacterium","Rhodococcus", "Mycobacteriaceae",
                            "Bacillus", "Azospirillium", "Janthinobacterium",
                            "Pseudomonas", "Variovorax", "Pedobacter")) +
  theme(axis.text.y=element_text(colour="black", size=18),
        axis.text.x=element_text(colour="black", size =12, angle = 35, hjust = 1),
        axis.title=element_text(size=20),
        axis.title.y = element_text(colour="black",  margin = margin(0,5,0,10)),
        axis.title.x = element_text(colour="black",margin=margin(5,0,0,0)),
        panel.border = element_rect(linetype = "solid", colour = "black", size=2, fill=NA),
        axis.ticks.length = unit(.25, "cm"),
        axis.ticks = element_line(size = 1.5),
        legend.title = element_text(size=14),
        legend.text=element_text(size=13.5)) +
  geom_hline(yintercept = 0, linetype="dashed", size =1) + 
  annotate("text", x = 1.15 , y=1.85, label = c("B"), size=10)


# Box plot showing Biomass difference between treatments # 
a.boxplot <- ggplot(data, aes(x=PDKBS0714, y = ADelta, fill = Phylum)) + 
  geom_boxplot(lwd = 0.75) +
  colScale

a.boxplot + 
  labs(x="Genera", y=expression(paste(Delta ,"Biomass yield"))) +
  theme_classic() +
    scale_x_discrete(labels=c("Micrococcus","Arthrobacter",
                            "Curtobacterium","Rhodococcus", "Mycobacteriaceae",
                            "Bacillus", "Azospirillium", "Janthinobacterium",
                            "Pseudomonas", "Variovorax", "Pedobacter")) +
  theme(axis.text.y=element_text(colour="black", size=18),
        axis.text.x=element_text(colour="black", size =12, angle = 35, hjust = 1),
        axis.title=element_text(size=20),
        axis.title.y = element_text(colour="black",  margin = margin(0,5,0,10)),
        axis.title.x = element_text(colour="black",margin=margin(5,0,0,0)),
        panel.border = element_rect(linetype = "solid", colour = "black", size=2, fill=NA),
        axis.ticks.length = unit(.25, "cm"),
        axis.ticks = element_line(size = 1.5),
        legend.title = element_text(size=14),
        legend.text=element_text(size=13.5)) +
  geom_hline(yintercept = 0, linetype="dashed", size =1) + 
  annotate("text", x = 1.1 , y=0.275, label = c("C"), size=10)

```

## 4) Rpf generality statistical analysis 

I performed Two Factor ANOVAs to test for significant effect of Rpf on growth curves and then post hoc TukeyHSF to determine direction of Rpf effect on each bacterial strains. 

```{r}
# Maximum growth rate # 
# Two factor ANOVA # 
umax.aov <- aov(umax ~ Treatment*Genus, data=umax.gc)
summary(umax.aov)
TukeyHSD(umax.aov)
posthoc <- TukeyHSD(x=umax.aov, 'Treatment', conf.level=0.95)
# Rpf treatment within strain genus has a strong effect on umax (F = 2.7188, p=0.006854) #


# Lag time to exponential growth # 
# Two factor ANOVA # 
L1 <- aov(L ~ Treatment*Genus, data=L.gc)
summary(L1)
posthoc <- TukeyHSD(x=L1, 'Treatment', conf.level=0.95)
TukeyHSD(L1)
posthoc

# Final biomass yeild # 
# Two factor ANOVA # 
a1 <- aov(A~Treatment*Genus, data=A.gc)
summary(a1)
TukeyHSD(a1)
posthoc <- TukeyHSD(x=a1, 'Treatment', conf.level=0.95)
posthoc
```





