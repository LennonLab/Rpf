---
title: "Rpf - growth curve"
author: "Jay T. Lennon"
date: "`r format(Sys.time(), '%d %B, %Y')`"
header-includes:
   - \usepackage{array}
output: pdf_document
geometry: margin=2.54cm
---

Overview: measured growth (OD600) over time on Micrococcus (KBS0714) with vs. without Rpf. Cells were grown in LMM medium (1% L-lithium lactate) at 35ml in 250 mL Klett flasks at 25C and 150 rpm. In +Rpf treatment, we added 350 uL of pET15b His+ 1.4mg mL (47.8uM initial, 341nM final). The inoculum was a 100 uL KBS0714 cells that had been stored for two months shaken plus 2 months on the bench.

# Set Directory
```{r}
rm(list=ls())
getwd()
setwd("C:/Users/Venus/Github/Rpf/growth")
```

# Load packages
```{r}
require("png")
```

# Load data
```{r}
od.raw <- read.csv("growth.curve.txt", head = TRUE, sep = "\t")
head(od.raw)

od.early <- od.raw[1:29,]
od.late <- od.raw[29:nrow(od.raw),1:5]

sem <- function(x) sqrt(var(x)/length(x))

od.cont <- data.frame(od.early[,1], apply(od.early[, 2:5], 1, mean), 
                      apply(od.early[, 2:5], 1, sem))
colnames(od.cont)[1:3] <- c("hour", "cont.mean", "cont.sem")

od.rpf <- data.frame(od.early[,1], apply(od.early[, 6:9], 1, mean), 
                      apply(od.early[, 6:9], 1, sem))
colnames(od.rpf)[1:3] <- c("hour", "rpf.mean", "rpf.sem")
```

# Make figure
```{r}
png(filename="C:/Users/Venus/Github/Rpf/growth/growth.curve.png",
    width = 1200, height = 700, res = 96*2)

plot.new()
par(mar = c(7, 7, 5, 7))

plot(od.cont[,1], od.cont[,2], xlim = c(0, 625), ylim = c(-0.5, 4), type = "b", 
     pch = 22, bg = "grey", col = "black", cex = 2, ylab = "", xlab = "", 
     cex.lab = 1.5, las = 1, lwd = 2, yaxt = "n", xaxt = "n",
     panel.first={
       arrows(x0 = od.cont[,1], y0 = od.cont[,2], y1 = od.cont[, 2] - od.cont[, 3],
              angle = 90, length = 0.05, lwd = 2)
       arrows(x0 = od.cont[,1], y0 = od.cont[,2], y1 = od.cont[, 2] + 
              od.cont[, 3], angle = 90,length = 0.05, lwd = 2)
})
box(lwd=2)

# Construct Rpf plot
points(od.rpf[,1], od.rpf[,2], type = "b", pch = 22, bg = "white", col = "black",
       cex = 2, cex.lab = 1.5, lwd = 2,
       panel.first={
         arrows(x0 = od.rpf[,1], y0 = od.rpf[, 2], y1 = od.rpf[, 2] - od.rpf[, 3], 
                angle = 90, length = 0.05, lwd = 2)
        arrows(x0 = od.rpf[,1], y0 = od.rpf[, 2], y1 = od.rpf[, 2] + od.rpf[, 3], 
               angle = 90, length = 0.05, lwd = 2)
         })

# Add ticks and tick labels
axis(side = 2, lwd.ticks = 2, las = 1, cex.axis = 1.25, 
   labels = c("0", "1", "2", "3", "4"), 
        at = c(0, 1, 2, 3, 4))

axis(side = 4, labels = F, lwd.ticks = 2, 
   at = c(0, 1, 2, 3, 4))

axis(side = 1, lwd.ticks = 2, cex.axis = 1.25, las = 1, mgp = c(3, 2, 0),
    labels = c(0, 100, 200, 300, 400, 500, 600), at = c(0, 100, 200, 300, 400, 500, 600))

axis(side = 3, labels = F, lwd.ticks = 2, las = 1, cex.axis = 1.25, 
   at = c(0, 100, 200, 300, 400))

mtext('Biomass (OD600)', side = 2, outer = TRUE, cex = 1.5, 
      line = -2, adj = 0.6)

mtext('Time (h)', side = 1, outer = TRUE, cex = 1.5, 
      line = -2.5, adj = 0.5)


# Add late ODs from controls
lines(od.late[,1], od.late[,2], lty=2, col="black", lwd = 2)
lines(od.late[,1], od.late[,3], lty=2, col="black", lwd = 2)
lines(od.late[,1], od.late[,4], lty=2, col="black", lwd = 2)
lines(od.late[,1], od.late[,5], lty=2, col="black", lwd = 2)

#dev.off()
#graphics.off()
```


## Brent Growth Curve Parameters with Rpf treatment ##

# Set working directory and load growth curve parameter data # 

```{r}
# Clear environment # 
rm(list = ls())

# Load and require dependencies # 
package.list <- c('vegan', 'nlme' ,'data.table', 'plyr', 'tidyr', 'dplyr', 'reshape', 'reshape2', 'ggplot2') 
for (package in package.list) {
  if (!require(package, character.only=T, quietly=T)) { 
    install.packages(package)
    library(package, character.only=T)
  } }

# Load Brent's growth curve data # 
brent <- read.csv("brent.csv", header = T)

brent <- brent[1:7 ,] # Remove one replicate of Rpf +, werid values 

# Subset relevant variables # 
brent <- subset(brent, select = c("Treatment", "Rep", "umax", "A", "L"))
```

# Maximum growth rate with treatment figure # 

```{r}
# Summarize umax values based on treatment type # 
brent.mean <- ddply(brent, c("Treatment"), summarise, mean=mean(umax))

# Bar graph showing the difference in umax between treatments for each strain # 
brent.mean.barplot <- ggplot(brent.mean, aes(x=Treatment, y = mean)) + 
  geom_bar(stat = "identity", width=0.5, position="dodge", color="black", size=1.25, fill="white") +
  theme_bw()  

# Standard Errors # 
brent.means.sem <- ddply(brent, c("Treatment"), summarise,
                   mean=mean(umax), sem=sd(umax)/sqrt(length(umax)))
brent.means.sem <- transform(brent.means.sem, lower=mean-sem, upper=mean+sem)

# Ploting bargraph with standard errors # 
brent.mean.barplot + 
  geom_errorbar(aes(ymax=upper, ymin=lower), position=position_dodge(0.9), width=0.15, data=brent.means.sem)  +
  labs(x="Treatment", y="Maximum growth rate") +
  theme_classic() +
  theme(axis.text=element_text(colour="black", size=18),
        axis.title=element_text(size=20),
        axis.title.y = element_text(colour="black",  margin = margin(0,25,0,0)),
        axis.title.x = element_text(colour="black",margin=margin(18,0,0,0)),
        panel.border = element_rect(linetype = "solid", colour = "black", size=2, fill=NA))

brent.umax.t <- t.test(umax~Treatment, data=brent)
brent.umax.t # umax increased with Rpf treatment 
# t = -4.16, df = 3.91, p-value = 0.015 # 

```

# Lag time with Rpf treatment figure #

```{r}
# Summarize lag time growth parameters # 
brent.mean.l <- ddply(brent, c("Treatment"), summarise, mean=mean(L))

# Bar graph showing the difference in lag time between treatments for each strain # 
brent.mean.l.barplot <- ggplot(brent.mean.l, aes(x=Treatment, y = mean)) + 
  geom_bar(stat = "identity", width=0.5, position="dodge", color="black", size=1.25, fill="white") +
  theme_bw()  

# Standard Errors # 
brent.means.l.sem <- ddply(brent, c("Treatment"), summarise,
                   mean=mean(L), sem=sd(L)/sqrt(length(L)))
brent.means.l.sem <- transform(brent.means.l.sem, lower=mean-sem, upper=mean+sem)

# Ploting bargraph with standard errors # 
brent.mean.l.barplot + 
  geom_errorbar(aes(ymax=upper, ymin=lower), position=position_dodge(0.9), width=0.15, data=brent.means.l.sem)  +
  labs(x="Treatment", y="Lag Time") +
  theme_classic() +
  theme(axis.text=element_text(colour="black", size=18),
        axis.title=element_text(size=20),
        axis.title.y = element_text(colour="black",  margin = margin(0,25,0,0)),
        axis.title.x = element_text(colour="black",margin=margin(18,0,0,0)),
        panel.border = element_rect(linetype = "solid", colour = "black", size=2, fill=NA))

brent.l.t <- t.test(L~Treatment, data=brent)
brent.l.t # Lag time does not seem to be different among treatment but that doesn't make sense 
```


# Biomass Yield with Rpf treatment figure #

```{r}
# Summarize Biomass (A) data # 
brent.mean.a <- ddply(brent, c("Treatment"), summarise, mean=mean(A))

# Bar graph showing the difference in umax between treatments for each strain # 
brent.mean.a.barplot <- ggplot(brent.mean.a, aes(x=Treatment, y = mean)) + 
  geom_bar(stat = "identity", width=0.5, position="dodge", color="black", size=1.25, fill="white") +
  theme_bw()  

# Standard Errors # 
brent.means.a.sem <- ddply(brent, c("Treatment"), summarise,
                   mean=mean(A), sem=sd(A)/sqrt(length(A)))
brent.means.a.sem <- transform(brent.means.a.sem, lower=mean-sem, upper=mean+sem)

# Ploting bargraph with standard errors # 
brent.mean.a.barplot + 
  geom_errorbar(aes(ymax=upper, ymin=lower), position=position_dodge(0.9), width=0.15, data=brent.means.a.sem)  +
  labs(x="Treatment", y="Biomass Yield (OD600)") +
  theme_classic() +
  theme(axis.text=element_text(colour="black", size=18),
        axis.title=element_text(size=20), 
        axis.title.y = element_text(colour="black",  margin = margin(0,25,0,0)),
        axis.title.x = element_text(colour="black",margin=margin(18,0,0,0)),
        panel.border = element_rect(linetype = "solid", colour = "black", size=2, fill=NA))

brent.l.a <- t.test(A~Treatment, data=brent)
brent.l.a # Biomass increases with Rpf treatment 
# Results: t = -754, df = 4.97, p-value < 0.0005

```



